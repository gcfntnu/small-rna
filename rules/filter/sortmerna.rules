#-*- mode:snakemake -*-

include:
    'sortmerna.db'

REF = [','.join(i) for i in zip( expand(join('data', 'ext', 'sortmerna', '{db}.fasta'), db=DB), expand(join('data', 'ext', 'sortmerna', '{db}.idx'), db=DB))]
REF = ':'.join(REF)
    
rule rrna_sortmerna:
    input:
        fastq = _filter_get_contaminants_clean
    output:
        fastq = 'data/tmp/GCF-2018-547-tmp/smallrna/filtered/{sample}/{sample}.rrna.sortmerna.clean.fastq',
        counts = 'data/processed/smallrna/{sample}/{sample}.rrna.sortmerna.counts'
    params:
        args = '--fastx --sam ',
        ref = REF,
        aligned = ''
    shell:
        'sortmerna '
        '--reads {input.fastq} '
        '--ref {params.ref} '
        '{params.args} '
        
