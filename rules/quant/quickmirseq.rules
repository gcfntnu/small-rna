#-*- mode:snakemake -*-


rule quickmirseq_species_mirna:
    input:
        'hairpin'

rule quickmirseq_db:
    params:
        db = 'data/ext/quickmirseq'
    output:
        'data/ext/quickmirseq/database/{species}/db_stranded_0/smallRNA.1.ebwt'
    shell:
        """
        cp -r $QuickMIRSeq/database {params.db}
        
        """
rule quickmirseq_config:
    params:
        species = 'human',
        rna_db = '/database/human/db_stranded_0',
        dna_db = '/database/human/genome'
    output:
        'quickmirseq.config'
    shell:
        """
        echo SPECIES={params.species} >> {output}
        echo GENOME_BOWTIE_INDEX={input.rna_db} >> {output}
        echo GENOME_BOWTIE_INDEX={input.dna_db} >> {output}
        echo FASTQ_DIR={input.fastq_dir} >> {output}
        echo CPU={threads} >> {output}
        echo STRAND=1 >> {output}
        echo FASTQ_SUFFIX=fastq >> {output}
        echo OUTPUT_FOLDER=output >> {output}
        echo RUN_EXTENSION_EVALUATION=yes >> {output}
        echo CUTADAPT_REQUIRED=no >> {output}
        echo REFINE_MISMATACH_READS=yes >> {output}
        echo ZEROCOUNT_THRESHOLD=0 >> {output}
        echo ZEROCOUNT_SAMPLE_THRESHOLD=0.60 >> {output}
        echo AVG_READ_THRESHOLD=2 >> {output}
        echo MIN_MIRNA_LENGTH=16 >> {output}
        echo MAX_MIRNA_LENGTH=28 >> {output}
        echo keepTemp=yes >> {output}
        echo UNIQUE_LIBRARY_ANALYSIS=yes >> {output}
        echo OFFSET_ANALYSIS=yes >> {output}
        """    

rule quickmirseq_input:
    output:
        'all_samples.txt'
        
rule quickmirseq:
    singularity:
        'docker://flatberg/quickmirseq:01'
    shell:
        'perl  $QuickMIRSeq/QuickMIRSeq.pl  '
        'allIDs.txt '
        'run.config'
