#-*- mode:snakemake -*-
"""miRge - microRNA alignment software for small RNA-seq data

https://github.com/mhalushka/miRge


This is the database download part.

For DB builds: https://github.com/mhalushka/miRge_build

"""
from os.path import join

URLS =  {'human':
         'https://jh.box.com/shared/static/rj7ufy5v15uw7ytsyyrsryw99u7ml82j.gz',
         'mouse':
         'mouse.tar.gz https://jh.box.com/shared/static/z2bcey8j9e9nxnvpmb4fm88zzq3da4m1.gz',
         'rat':
         'rat.tar.gz https://jh.box.com/shared/static/mmztv42j8h7snk0eo80o7a7t30it4q9f.gz',
         'zebrafish':
         'https://jh.box.com/shared/static/nwn7jzn5ekgm51k7jlk43a6h75aasgr1.gz',
         'nematode':
         'https://jh.box.com/shared/static/nwn7jzn5ekgm51k7jlk43a6h75aasgr1.gz',
         'fruitfly':
         'fruitfly.tar.gz https://jh.box.com/shared/static/ilrnq62cp06pviir5t0mh85aqet0fmjq.gz'
         }
MIRGE_ORG = {'homo_sapiens': 'human',
           'human': 'human',
           'human': 'human',
           'mus_musculus': 'mouse',
           'mouse': 'mouse',
           'mouse': 'mouse',
           'rattus_norvegicus': 'rat',
           'rat': 'rat',
           'rat': 'rat'}

rule download_db:
    params:
        url = lambda wildcards: URLS[MIRGE_ORG[wildcards.org]],
        out = join(EXT_DIR, 'mirge', '{org}')
    output:
        join(EXT_DIR, 'mirge', '{org}', 'index.Libs', 'human_snorna.3.ebwt')
    shell:
        'wget -qO- {params.url} | tar xvz --strip-components 1 -C {params.out}'

rule mirge_db:
    input:
        expand('data/ext/mirge/{org}/index.Libs/{org}_snorna.3.ebwt', org=['human'])
