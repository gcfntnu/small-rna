#-*- mode:snakemake -*-

import os

rule unitas:
    input:
        fastq = get_filtered_fastq
    params:
        org = 'homo_sapiens',
        tmpdir = 'data/tmp/GCF-2018-547-tmp/unitas',
        outdir = os.path.abspath('data/processed/smallrna/unitas/{sample}'),
        args = '-riborase -tail 3'
    output:
        'data/processed/smallrna/unitas/{sample}/unitas.annotation_summary.txt'
    singularity:
        'docker://flatberg/unitas:1.6.0'
    threads:
        12
    shell:
        """
        mkdir -p {params.tmpdir}
        cd {params.tmpdir} || exit
        rm -rf *_#*
        unitas.pl -input {input.fastq} -s {params.org} -threads {threads} {params.args}
        mv UNITAS_*_{wildcards.sample}.*fastq_#1/* {params.outdir}/
        """
