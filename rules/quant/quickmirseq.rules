#-*- mode:snakemake -*-
from os.path import dirname

include:
    'quickmirseq.db'
    
rule quickmirseq_config:
    params:
        fastq_dir = 'data/tmp/GCF',
        species = 'human',
        rna_db = 'data/ext/quickmirseq/databases/homo_sapiens',
        dna_bowtie_index = 'data/ext/quickmirseq/homo_sapiens/genome/'
    threads:
        8
    output:
        'quickmirseq.config'
    shell:
        """
        echo SPECIES={params.species} >> {output}
        echo RNA_BOWTIE_INDEX={params.rna_db} >> {output}
        echo GENOME_BOWTIE_INDEX={params.dna_db} >> {output}
        echo FASTQ_DIR={params.fastq_dir} >> {output}
        echo CPU={threads} >> {output}
        echo STRAND=1 >> {output}
        echo FASTQ_SUFFIX=data/processed/quickmirseq/test >> {output}
        echo OUTPUT_FOLDER=output >> {output}
        echo RUN_EXTENSION_EVALUATION=yes >> {output}
        echo CUTADAPT_REQUIRED=no >> {output}
        echo REFINE_MISMATACH_READS=yes >> {output}
        echo ZEROCOUNT_THRESHOLD=0 >> {output}
        echo ZEROCOUNT_SAMPLE_THRESHOLD=0.60 >> {output}
        echo AVG_READ_THRESHOLD=2 >> {output}
        echo MIN_MIRNA_LENGTH=16 >> {output}
        echo MAX_MIRNA_LENGTH=28 >> {output}
        echo keepTemp=yes >> {output}
        echo UNIQUE_LIBRARY_ANALYSIS=yes >> {output}
        echo OFFSET_ANALYSIS=yes >> {output}
        """    

rule quickmirseq_input:
    output:
        'all_samples.txt'
        
rule quickmirseq:
    singularity:
        'docker://flatberg/quickmirseq:01'
    shell:
        'perl  $QuickMIRSeq/QuickMIRSeq.pl  '
        'allIDs.txt '
        'run.config'
